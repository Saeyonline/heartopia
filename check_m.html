<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë‘ê·¼ë‘ê·¼ íƒ€ìš´ ì²´í¬ ë¦¬ìŠ¤íŠ¸</title>

  <style>
    /* ê·€ì—¬ìš´ í°íŠ¸(ê°€ëŠ¥í•˜ë©´) + ì•ˆì „í•œ ëŒ€ì²´ í°íŠ¸ */
    @import url('https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Jua&display=swap');

    :root{
      --bg1:#fff3f8;
      --bg2:#f3fbff;
      --card:#ffffffcc;
      --ink:#232323;
      --muted:#777;
      --accent:#ff6fb7;
      --accent2:#6fd5ff;
      --shadow: 0 12px 30px rgba(0,0,0,.10);
      --radius: 22px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: "Gamja Flower","Jua","Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",system-ui,-apple-system,"Segoe UI",sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 450px at 15% 10%, #ffe0f0 0%, transparent 60%),
        radial-gradient(900px 450px at 85% 15%, #dff5ff 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{max-width: 980px; margin: 0 auto; padding: 28px 18px 40px;}

    header{text-align:center; padding: 6px 0 18px;}
    .title{
      display:inline-block;
      font-weight: 900;
      letter-spacing: .08em;
      font-size: clamp(28px, 4.2vw, 52px);
      padding: 10px 20px;
      border-radius: 999px;
      background:#fff;
      box-shadow: var(--shadow);
      position: relative;
    }

    .grid{display:grid; grid-template-columns: 1fr 1fr; gap: 18px; align-items:start;}

    .card{
      background: var(--card);
      border: 2px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(8px);
    }

    .cardHead{
      padding:14px 16px;
      border-bottom:1px dashed rgba(0,0,0,.1);
      background:
        radial-gradient(450px 150px at 10% 0%, #ffe3f3 0%, transparent 55%),
        radial-gradient(450px 150px at 90% 0%, #dff7ff 0%, transparent 55%);
    }

    .cardTitle{
      font-size:22px;
      font-weight:900;
      letter-spacing:.06em;
      padding:10px 14px;
      border-radius:14px;
      background:#111;
      color:#fff;
      text-align:center;
    }

    .resetLine{
      margin-top:8px;
      font-size:14px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
      font-weight:900;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:999px;
      box-shadow: 0 8px 18px rgba(0,0,0,.07);
    }

    .cardBody{padding:12px 16px 16px;}

    ul.list{list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px;}

    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px;
      border-radius:16px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:0 8px 16px rgba(0,0,0,.06);
      cursor:pointer;
      transition: background .15s, opacity .15s, transform .05s;
    }
    .item:active{transform: translateY(1px);}

    /* ì²´í¬(ì™„ë£Œ) ì‹œ ì–´ë‘¡ê²Œ */
    .item.checked{
      opacity:.45;
    }

    .left{display:flex; align-items:center; gap:10px; min-width:0;}

    input[type="checkbox"]{
      width:20px;
      height:20px;
      accent-color:var(--accent);
      cursor:pointer;
      flex: 0 0 auto;
    }

    .label{
      font-size:18px;
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .progress{display:flex; gap:6px; flex: 0 0 auto;}
    .pbox{width:18px; height:18px; border-radius:6px; border:2px solid rgba(0,0,0,.25); background:#fff;}
    .pbox.filled{background:var(--accent); border-color:transparent; box-shadow: 0 8px 16px rgba(255,111,183,.22);}

    .footer{margin-top:18px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;}
    button{
      padding:14px 18px;
      border-radius:16px;
      font-weight:900;
      border:2px solid rgba(0,0,0,.15);
      background:#fff;
      cursor:pointer;
      box-shadow:var(--shadow);
      font-family: inherit;
    }

    @media(max-width:860px){
      .grid{grid-template-columns:1fr;}
      button{width:100%;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">ë‘ê·¼ë‘ê·¼ íƒ€ìš´ ì²´í¬ ë¦¬ìŠ¤íŠ¸</div>
    </header>

    <main class="grid">
      <!-- ì¼ì¼ í€˜ìŠ¤íŠ¸ -->
      <section class="card">
        <div class="cardHead">
          <div class="cardTitle">ì¼ì¼ í€˜ìŠ¤íŠ¸</div>
          <div class="resetLine">
            <span class="pill">â° ì¼ì¼ ì´ˆê¸°í™”ê¹Œì§€: <span id="dailyCountdown">-</span></span>
            <span class="pill">KST 06:00</span>
          </div>
        </div>
        <div class="cardBody">
          <ul class="list" id="dailyList"></ul>
        </div>
      </section>

      <!-- ì£¼ê°„ í€˜ìŠ¤íŠ¸ + ë¹™ì„¤ ì´ë²¤íŠ¸ ë¬¶ìŒ -->
      <section class="card">
        <div class="cardHead">
          <div class="cardTitle">ì£¼ê°„ í€˜ìŠ¤íŠ¸</div>
          <div class="resetLine">
            <span class="pill">ğŸ—“ï¸ ì£¼ê°„ ì´ˆê¸°í™”ê¹Œì§€: <span id="weeklyCountdown">-</span></span>
            <span class="pill">í† ìš”ì¼ 06:00 (KST)</span>
          </div>
        </div>
        <div class="cardBody">
          <ul class="list" id="weeklyList"></ul>

          <!-- ë¹™ì„¤ ì´ë²¤íŠ¸ (ì£¼ê°„ í€˜ìŠ¤íŠ¸ ì•„ë˜) -->
          <div style="margin-top:18px"></div>
          <div class="cardTitle" style="margin-bottom:10px">ë¹™ì„¤ ì´ë²¤íŠ¸</div>
          <ul class="list" id="eventList"></ul>
        </div>
      </section>
    </main>

    <div class="footer">
      <button id="btnResetDaily">ì¼ì¼ ìˆ˜ë™ ì´ˆê¸°í™”</button>
      <button id="btnResetWeekly">ì£¼ê°„ ìˆ˜ë™ ì´ˆê¸°í™”</button>
      <button id="btnResetAll">ì „ì²´ ì´ˆê¸°í™”</button>
    </div>
  </div>

<script>
  /*
    ìš”êµ¬ì‚¬í•­(ì •ë¦¬)
    - ì¼ì¼ ì´ˆê¸°í™”: í•œêµ­ì‹œê°„(KST) ë§¤ì¼ 06:00
    - ì£¼ê°„ ì´ˆê¸°í™”: í•œêµ­ì‹œê°„(KST) í† ìš”ì¼ 06:00
    - ì¼ì¼ ë¦¬ì…‹: [ì¼ì¼í€˜ìŠ¤íŠ¸] ì „ë¶€ + ë¹™ì„¤ ì´ë²¤íŠ¸(ì—ê·¸ ì°¾ê¸°, íŠ¸ëœë”” ìƒì  í™•ì¸)
    - ì£¼ê°„ ë¦¬ì…‹: [ì£¼ê°„í€˜ìŠ¤íŠ¸] ì „ë¶€ + ë¹™ì„¤ ì´ë²¤íŠ¸(ì£¼ê°„ í€˜ìŠ¤íŠ¸ 10ê°œ)
    - NEVER ë¦¬ì…‹: ë„ê° 5ì¢…(ì–´ë¥˜/ìš”ë¦¬/ê³¤ì¶©/ì›ì˜ˆ/ì¡°ë¥˜)

    UI ë™ì‘
    - ì²´í¬í˜•: ì²´í¬ë°•ìŠ¤/í’ˆëª© í´ë¦­ ëª¨ë‘ í† ê¸€
    - ì§„í–‰í˜•(ì¼ì¼ 5ê°œ, ì£¼ê°„ 10ê°œ, ì‚¬ê±´ 2íšŒ ë“±):
      * ì²´í¬ë°•ìŠ¤ í´ë¦­ = ì¦‰ì‹œ max(ì™„ë£Œ) / í•´ì œ ì‹œ 0
      * í’ˆëª©(ì²´í¬ë°•ìŠ¤ ë°–) ë˜ëŠ” ë„¤ëª¨ì¹¸ ì˜ì—­ í´ë¦­ = 0â†’1â†’â€¦â†’maxâ†’0 ìˆœí™˜
    - ì²´í¬ë˜ë©´ í’ˆëª© ì–´ë‘¡ê²Œ(opacity)
  */

  const RESET = { DAILY:'daily', WEEKLY:'weekly', NEVER:'never' };

  const DATA = {
    daily: [
      { id:'d_attendance', label:'ì¶œì„ì²´í¬', reset: RESET.DAILY, type:'check' },
      { id:'d_seed',       label:'ì”¨ì•— ì‹¬ê¸°/ë¬¼ ì£¼ê¸°', reset: RESET.DAILY, type:'check' },
      { id:'d_mine',       label:'í˜•ê´‘ì„/ì°¸ë‚˜ë¬´ ìºê¸°', reset: RESET.DAILY, type:'check' },
      { id:'d_buy',        label:'ê³„ë€/ì„¸ì¼ í’ˆëª© êµ¬ë§¤', reset: RESET.DAILY, type:'check' },
      { id:'d_shop',       label:'ì˜ìƒ/ê°€êµ¬/í« í™•ì¸', reset: RESET.DAILY, type:'check' },
      { id:'d_quest5',     label:'ì¼ì¼ í€˜ìŠ¤íŠ¸ 5ê°œ', reset: RESET.DAILY, type:'progress', max:5 },
      { id:'d_puzzle',     label:'ì¹´ì¹­ í¼ì¦ í™•ì¸', reset: RESET.DAILY, type:'check' },
      { id:'d_animal_day', label:'ë™ë¬¼ ë°¥ ì£¼ê¸° (ë‚®)', reset: RESET.DAILY, type:'check' },
      { id:'d_animal_night',label:'ë™ë¬¼ ë°¥ ì£¼ê¸° (ë°¤)', reset: RESET.DAILY, type:'check' },
      { id:'d_pet',        label:'í« ë°¥/ë†€ì•„ì£¼ê¸°', reset: RESET.DAILY, type:'check' },
    ],
    weekly: [
      { id:'w_pink',  label:'í•‘í¬ë²„ë¸”', reset: RESET.WEEKLY, type:'check' },
      { id:'w_story2',label:'ì£¼ê°„ í€˜ìŠ¤íŠ¸(ì‚¬ê±´ 2íšŒ)', reset: RESET.WEEKLY, type:'progress', max:2 },
    ],
    event: [
      { id:'e_egg',    label:'ì—ê·¸ ì°¾ê¸°', reset: RESET.DAILY, type:'check' },
      { id:'e_trendy', label:'íŠ¸ëœë”” ìƒì  í™•ì¸', reset: RESET.DAILY, type:'check' },
      { id:'e_ev10',   label:'ì£¼ê°„ í€˜ìŠ¤íŠ¸ 10ê°œ', reset: RESET.WEEKLY, type:'progress', max:10 },
      { id:'e_fish',   label:'ì–´ë¥˜ ë„ê°', reset: RESET.NEVER, type:'check' },
      { id:'e_food',   label:'ìš”ë¦¬ ë„ê°', reset: RESET.NEVER, type:'check' },
      { id:'e_bug',    label:'ê³¤ì¶© ë„ê°', reset: RESET.NEVER, type:'check' },
      { id:'e_garden', label:'ì›ì˜ˆ ë„ê°', reset: RESET.NEVER, type:'check' },
      { id:'e_bird',   label:'ì¡°ë¥˜ ë„ê°', reset: RESET.NEVER, type:'check' },
    ]
  };

  const STORAGE_KEY = 'ddtown_checklist_clean_v1';

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return { items:{}, lastDailyResetISO:null, lastWeeklyResetISO:null };
      const s = JSON.parse(raw);
      s.items ||= {};
      return s;
    }catch{
      return { items:{}, lastDailyResetISO:null, lastWeeklyResetISO:null };
    }
  }

  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  const state = loadState();

  // ---- KST time helpers ----
  const KST_OFFSET_MIN = 9 * 60;

  function nowKST(){
    const now = new Date();
    const utcMs = now.getTime() + now.getTimezoneOffset() * 60 * 1000;
    return new Date(utcMs + KST_OFFSET_MIN * 60 * 1000);
  }

  function startOfDayKST(d){
    const x = new Date(d.getTime());
    x.setHours(0,0,0,0);
    return x;
  }

  function lastDailyBoundaryKST(now){
    const base = startOfDayKST(now);
    const b = new Date(base.getTime());
    b.setHours(6,0,0,0);
    if(now.getTime() < b.getTime()) b.setDate(b.getDate()-1);
    return b;
  }

  function lastWeeklyBoundaryKST(now){
    const base = startOfDayKST(now);
    const b = new Date(base.getTime());
    b.setHours(6,0,0,0);
    // last Saturday
    const day = b.getDay(); // 0 Sun .. 6 Sat
    const daysSinceSat = (day - 6 + 7) % 7;
    b.setDate(b.getDate() - daysSinceSat);
    if(now.getTime() < b.getTime()) b.setDate(b.getDate() - 7);
    return b;
  }

  function nextDailyResetKST(now){
    const base = startOfDayKST(now);
    const n = new Date(base.getTime());
    n.setHours(6,0,0,0);
    if(now.getTime() >= n.getTime()) n.setDate(n.getDate()+1);
    return n;
  }

  function nextWeeklyResetKST(now){
    const base = startOfDayKST(now);
    const n = new Date(base.getTime());
    n.setHours(6,0,0,0);
    const day = n.getDay();
    const daysUntilSat = (6 - day + 7) % 7;
    n.setDate(n.getDate() + daysUntilSat);
    if(now.getTime() >= n.getTime()) n.setDate(n.getDate()+7);
    return n;
  }

  function formatCountdown(ms, mode){
    if(ms < 0) ms = 0;
    const total = Math.floor(ms/1000);
    const days = Math.floor(total/86400);
    const hours = Math.floor((total%86400)/3600);
    const mins = Math.floor((total%3600)/60);
    const secs = total%60;
    const pad = (n)=> String(n).padStart(2,'0');
    if(mode==='daily') return `${hours + days*24}ì‹œê°„ ${pad(mins)}ë¶„ ${pad(secs)}ì´ˆ`;
    return `${days}ì¼ ${pad(hours)}ì‹œê°„ ${pad(mins)}ë¶„ ${pad(secs)}ì´ˆ`;
  }

  // ---- Reset logic ----
  function resetByType(resetType, {fromAuto=false}={}){
    const all = [...DATA.daily, ...DATA.weekly, ...DATA.event];
    for(const it of all){
      if(it.reset !== resetType) continue;
      if(it.reset === RESET.NEVER) continue;
      delete state.items[it.id];
    }
    if(!fromAuto) saveState();
  }

  function resetAll(){
    state.items = {};
    state.lastDailyResetISO = null;
    state.lastWeeklyResetISO = null;
    saveState();
  }

  function autoResetIfNeeded(){
    const now = nowKST();
    const lastD = lastDailyBoundaryKST(now).getTime();
    const lastW = lastWeeklyBoundaryKST(now).getTime();

    const storedD = state.lastDailyResetISO ? new Date(state.lastDailyResetISO).getTime() : null;
    const storedW = state.lastWeeklyResetISO ? new Date(state.lastWeeklyResetISO).getTime() : null;

    if(storedD === null || storedD < lastD){
      resetByType(RESET.DAILY, {fromAuto:true});
      state.lastDailyResetISO = new Date(lastD).toISOString();
    }
    if(storedW === null || storedW < lastW){
      resetByType(RESET.WEEKLY, {fromAuto:true});
      state.lastWeeklyResetISO = new Date(lastW).toISOString();
    }
    saveState();
  }

  // ---- UI render ----
  function renderList(listId, items){
    const ul = document.getElementById(listId);
    ul.innerHTML = '';

    for(const it of items){
      const li = document.createElement('li');
      li.className = 'item';

      const left = document.createElement('div');
      left.className = 'left';

      const cb = document.createElement('input');
      cb.type = 'checkbox';

      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = it.label;

      // ---- CHECK ----
      if(it.type === 'check'){
        cb.checked = !!state.items[it.id];
        li.classList.toggle('checked', cb.checked);

        const apply = ()=> li.classList.toggle('checked', cb.checked);

        cb.addEventListener('click', (ev)=> ev.stopPropagation());
        cb.addEventListener('change', ()=>{
          if(cb.checked) state.items[it.id] = true;
          else delete state.items[it.id];
          saveState();
          apply();
        });

        li.addEventListener('click', ()=>{
          cb.checked = !cb.checked;
          cb.dispatchEvent(new Event('change'));
        });

        left.append(cb, label);
        li.append(left);
      }

      // ---- PROGRESS ----
      if(it.type === 'progress'){
        const current = Number.isInteger(state.items[it.id]) ? state.items[it.id] : 0;

        const progress = document.createElement('div');
        progress.className = 'progress';

        const boxes = [];
        for(let i=1;i<=it.max;i++){
          const b = document.createElement('div');
          b.className = 'pbox' + (i<=current ? ' filled' : '');
          boxes.push(b);
          progress.appendChild(b);
        }

        const apply = (val)=>{
          cb.checked = (val === it.max);
          li.classList.toggle('checked', cb.checked);
          for(let i=0;i<boxes.length;i++){
            boxes[i].classList.toggle('filled', (i+1) <= val);
          }
        };
        apply(current);

        // ì²´í¬ë°•ìŠ¤ í´ë¦­: ì¦‰ì‹œ ì™„ë£Œ/í•´ì œ
        cb.addEventListener('click', (ev)=> ev.stopPropagation());
        cb.addEventListener('change', ()=>{
          const next = cb.checked ? it.max : 0;
          if(next === 0) delete state.items[it.id];
          else state.items[it.id] = next;
          saveState();
          apply(next);
        });

        // ë„¤ëª¨ì¹¸ í´ë¦­: 1ì¹¸ì”© ìˆœí™˜
        progress.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          const prev = Number.isInteger(state.items[it.id]) ? state.items[it.id] : 0;
          const next = (prev + 1) > it.max ? 0 : (prev + 1);
          if(next === 0) delete state.items[it.id];
          else state.items[it.id] = next;
          saveState();
          apply(next);
        });

        // í’ˆëª© í´ë¦­(ì²´í¬ë°•ìŠ¤ ì œì™¸): 1ì¹¸ì”© ìˆœí™˜
        li.addEventListener('click', ()=>{
          const prev = Number.isInteger(state.items[it.id]) ? state.items[it.id] : 0;
          const next = (prev + 1) > it.max ? 0 : (prev + 1);
          if(next === 0) delete state.items[it.id];
          else state.items[it.id] = next;
          saveState();
          apply(next);
        });

        left.append(cb, label);
        li.append(left, progress);
      }

      ul.appendChild(li);
    }
  }

  function renderAll(){
    renderList('dailyList', DATA.daily);
    renderList('weeklyList', DATA.weekly);
    renderList('eventList', DATA.event);
  }

  // ---- Buttons ----
  document.getElementById('btnResetDaily').addEventListener('click', ()=>{
    resetByType(RESET.DAILY);
    const now = nowKST();
    state.lastDailyResetISO = new Date(lastDailyBoundaryKST(now).getTime()).toISOString();
    saveState();
    renderAll();
  });

  document.getElementById('btnResetWeekly').addEventListener('click', ()=>{
    resetByType(RESET.WEEKLY);
    const now = nowKST();
    state.lastWeeklyResetISO = new Date(lastWeeklyBoundaryKST(now).getTime()).toISOString();
    saveState();
    renderAll();
  });

  document.getElementById('btnResetAll').addEventListener('click', ()=>{
    const ok = confirm('ì „ì²´ ì´ˆê¸°í™”í• ê¹Œìš”? (ë„ê° í¬í•¨ ì „ë¶€)');
    if(!ok) return;
    resetAll();
    renderAll();
  });

  // ---- Countdown ----
  function tick(){
    const now = nowKST();
    const nextD = nextDailyResetKST(now);
    const nextW = nextWeeklyResetKST(now);

    document.getElementById('dailyCountdown').textContent = formatCountdown(nextD.getTime()-now.getTime(), 'daily');
    document.getElementById('weeklyCountdown').textContent = formatCountdown(nextW.getTime()-now.getTime(), 'weekly');

    // ê²½ê³„ í†µê³¼ ìë™ ë¦¬ì…‹
    const lastD = lastDailyBoundaryKST(now).getTime();
    const lastW = lastWeeklyBoundaryKST(now).getTime();
    const storedD = state.lastDailyResetISO ? new Date(state.lastDailyResetISO).getTime() : null;
    const storedW = state.lastWeeklyResetISO ? new Date(state.lastWeeklyResetISO).getTime() : null;

    let changed = false;
    if(storedD === null || storedD < lastD){
      resetByType(RESET.DAILY, {fromAuto:true});
      state.lastDailyResetISO = new Date(lastD).toISOString();
      changed = true;
    }
    if(storedW === null || storedW < lastW){
      resetByType(RESET.WEEKLY, {fromAuto:true});
      state.lastWeeklyResetISO = new Date(lastW).toISOString();
      changed = true;
    }
    if(changed){
      saveState();
      renderAll();
    }
  }

  // ---- Init ----
  autoResetIfNeeded();
  renderAll();
  tick();
  setInterval(tick, 250);
</script>
</body>
</html>
